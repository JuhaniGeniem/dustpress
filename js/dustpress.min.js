function j(e){for(e=0;4>e;e++)try{return e?new ActiveXObject([,"Msxml2","Msxml3","Microsoft"][e]+".XMLHTTP"):new XMLHttpRequest}catch(t){}}function ajaxGet(e,t){var n=j();return n.onreadystatechange=function(){var e;if(4==n.readyState){if(200==n.status){var a=n.getResponseHeader("Content-type").split(";")[0];switch(a){case"text/html":e=n.responseText;break;case"application/json":try{e=JSON.parse(n.responseText)}catch(r){e={error:{text:r},responseText:n.responseText}}break;default:console.error("Unknown Content-type",a)}}else e.error={code:n.status,text:n.statusText};t&&t(e)}},n.open("GET",e,!0),n.send(),n}function ajaxPost(e,t,n){var a=j();return a.onreadystatechange=function(){if(4==a.readyState){var e;try{e=JSON.parse(a.responseText)}catch(t){e={Message:a.responseText}}200!=a.status&&(e.error={code:a.status,text:a.statusText}),n&&n(e)}},a.open("POST",e,!0),a.setRequestHeader("Content-type","application/json"),a.send(JSON.stringify(t)),a}function ApiCaller(e,t,n){this.isApi=!0,this.maxage=t?1e3*t:1e3,this.url=e,this.q=n,this.ckey=this.url}function contentLoaded(e,t){var n=!1,a=!0,r=e.document,o=r.documentElement,i=r.addEventListener?"addEventListener":"attachEvent",s=r.addEventListener?"removeEventListener":"detachEvent",d=r.addEventListener?"":"on",u=function(a){("readystatechange"!=a.type||"complete"==r.readyState)&&(("load"==a.type?e:r)[s](d+a.type,u,!1),!n&&(n=!0)&&t.call(e,a.type||a))},c=function(){try{o.doScroll("left")}catch(e){return void setTimeout(c,50)}u("poll")};if("complete"==r.readyState)t.call(e,"lazy");else{if(r.createEventObject&&o.doScroll){try{a=!e.frameElement}catch(v){}a&&c()}r[i](d+"DOMContentLoaded",u,!1),r[i](d+"readystatechange",u,!1),e[i](d+"load",u,!1)}}function addEvent(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else{n.$$guid||(n.$$guid=addEvent.guid++),e.events||(e.events={});var a=e.events[t];a||(a=e.events[t]={},e["on"+t]&&(a[0]=e["on"+t])),a[n.$$guid]=n,e["on"+t]=handleEvent}}function removeEvent(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.events&&e.events[t]&&delete e.events[t][n.$$guid]}function handleEvent(e){var t=!0;e=e||fixEvent(((this.ownerDocument||this.document||this).parentWindow||window).event);var n=this.events[e.type];for(var a in n)this.$$handleEvent=n[a],this.$$handleEvent(e)===!1&&(t=!1);return t}function fixEvent(e){return e.preventDefault=fixEvent.preventDefault,e.stopPropagation=fixEvent.stopPropagation,e}function stopEvt(e){e.stopped=!0,e.preventDefault?e.preventDefault():e.returnValue=!1}function dustpress(){addEvent(window,"click",function(e){for(var t,n,a,r,o,i,s,d=e.target||e.srcElement;d&&d.nodeName&&d.getAttribute&&!t;)n=d.getAttribute("href"),r=d.getAttribute("data-target")?document.getElementById(d.getAttribute("data-target")):null,o=d.getAttribute("data-append")?document.getElementById(d.getAttribute("data-append")):null,s=d.getAttribute("data-callback"),t=n&&(r||o||s),t?(a=d.getAttribute("data-args"),dust=d.getAttribute("data-dust"),i=d.getAttribute("data-beforesend")):d=d.parentNode;t&&(stopEvt(e),dust&&(n+=-1==n.indexOf("?")?"?dust="+dust:"&dust="+dust),i&&window[i]&&"function"==typeof window[i]&&window[i](d),ajaxGet(n,function(e){"object"!=typeof e&&(o&&o.insertAdjacentHTML("beforeEnd",e),r&&(r.innerHTML=e)),s&&window[s]&&"function"==typeof window[s]&&window[s](e,d)}))})}ApiCaller.prototype={post:function(e,t){var n=this,a=(new Date).getTime(),r="?"+a;if(n.q&&e)for(var o in e){if(-1==n.q.indexOf(o))return void alert("Puuttuva parametri "+o);r+="&"+o+"="+e[o],delete e[o]}ajaxPost(n.url+r,e,t)},get:function(e,t){var n=this,a=n.maxage,r=n.ckey,o=s.get(r),i=!1,d=(new Date).getTime(),u="?"+d;if(n.q&&e.q)for(var r in e.q){if(-1==n.q.indexOf(r))return void alert("Puuttuva parametri "+r);u+="&"+r+"="+e.q[r]}o&&o.goodbefore>d&&(t(o.data),i=!0),ajaxGet(n.url+u,function(e){e.error||s.set(r,{data:e,goodbefore:(new Date).getTime()+a}),i||t(e)})}},addEvent.guid=1,fixEvent.preventDefault=function(){this.returnValue=!1},fixEvent.stopPropagation=function(){this.cancelBubble=!0},contentLoaded(window,dustpress);